!function t(e,i,s){function a(r,o){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!o&&h)return h(r,!0);if(n)return n(r,!0);var p=new Error("Cannot find module '"+r+"'");throw p.code="MODULE_NOT_FOUND",p}var d=i[r]={exports:{}};e[r][0].call(d.exports,function(t){var i=e[r][1][t];return a(i||t)},d,d.exports,t,e,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(t,e,i){"use strict";var s,a=t(15),n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=function(){var t;s.prototype.init.call(this),this.push=function(e){var i,s,a,r,o,h,p=0,d=0;if("audio"===e.type)for(t?(r=t,t=new Uint8Array(r.byteLength+e.data.byteLength),t.set(r),t.set(e.data,r.byteLength)):t=e.data;p+5<t.length;)if(255===t[p]&&240==(246&t[p+1])){if(s=2*(1&~t[p+1]),i=(3&t[p+3])<<11|t[p+4]<<3|(224&t[p+5])>>5,o=1024*(1+(3&t[p+6])),h=9e4*o/n[(60&t[p+2])>>>2],a=p+i,t.byteLength<a)return;if(this.trigger("data",{pts:e.pts+d*h,dts:e.dts+d*h,sampleCount:o,audioobjecttype:1+(t[p+2]>>>6&3),channelcount:(1&t[p+2])<<2|(192&t[p+3])>>>6,samplerate:n[(60&t[p+2])>>>2],samplingfrequencyindex:(60&t[p+2])>>>2,samplesize:16,data:t.subarray(p+7+s,a)}),t.byteLength===a)return void(t=void 0);d++,t=t.subarray(a)}else p++},this.flush=function(){this.trigger("done")}},s.prototype=new a,e.exports=s},{}],2:[function(t,e,i){"use strict";var s,a,n,r=t(15),o=t(14);a=function(){var t,e,i=0;a.prototype.init.call(this),this.push=function(s){var a;for(e?(a=new Uint8Array(e.byteLength+s.data.byteLength),a.set(e),a.set(s.data,e.byteLength),e=a):e=s.data;i<e.byteLength-3;i++)if(1===e[i+2]){t=i+5;break}for(;t<e.byteLength;)switch(e[t]){case 0:if(0!==e[t-1]){t+=2;break}if(0!==e[t-2]){t++;break}i+3!==t-2&&this.trigger("data",e.subarray(i+3,t-2));do{t++}while(1!==e[t]&&t<e.length);i=t-2,t+=3;break;case 1:if(0!==e[t-1]||0!==e[t-2]){t+=3;break}this.trigger("data",e.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}e=e.subarray(i),t-=i,i=0},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(i+3)),e=null,i=0,this.trigger("done")}},a.prototype=new r,n={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},s=function(){var t,e,i,r,h,p,d,l=new a;s.prototype.init.call(this),t=this,this.push=function(t){"video"===t.type&&(e=t.trackId,i=t.pts,r=t.dts,l.push(t))},l.on("data",function(s){var a={trackId:e,pts:i,dts:r,data:s};switch(31&s[0]){case 5:a.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:a.nalUnitType="sei_rbsp",a.escapedRBSP=h(s.subarray(1));break;case 7:a.nalUnitType="seq_parameter_set_rbsp",a.escapedRBSP=h(s.subarray(1)),a.config=p(a.escapedRBSP);break;case 8:a.nalUnitType="pic_parameter_set_rbsp";break;case 9:a.nalUnitType="access_unit_delimiter_rbsp"}t.trigger("data",a)}),l.on("done",function(){t.trigger("done")}),this.flush=function(){l.flush()},d=function(t,e){var i,s,a=8,n=8;for(i=0;i<t;i++)0!==n&&(s=e.readExpGolomb(),n=(a+s+256)%256),a=0===n?a:n},h=function(t){for(var e,i,s=t.byteLength,a=[],n=1;n<s-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return t;e=s-a.length,i=new Uint8Array(e);var r=0;for(n=0;n<e;r++,n++)r===a[0]&&(r++,a.shift()),i[n]=t[r];return i},p=function(t){var e,i,s,a,r,h,p,l,c,u,f,g,y,m=0,b=0,v=0,T=0,w=1;if(e=new o(t),i=e.readUnsignedByte(),a=e.readUnsignedByte(),s=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),n[i]&&(r=e.readUnsignedExpGolomb(),3===r&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(f=3!==r?8:12,y=0;y<f;y++)e.readBoolean()&&(y<6?d(16,e):d(64,e));if(e.skipUnsignedExpGolomb(),0===(h=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===h)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),p=e.readUnsignedExpGolomb(),y=0;y<p;y++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),l=e.readUnsignedExpGolomb(),c=e.readUnsignedExpGolomb(),u=e.readBits(1),0===u&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(m=e.readUnsignedExpGolomb(),b=e.readUnsignedExpGolomb(),v=e.readUnsignedExpGolomb(),T=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}g&&(w=g[0]/g[1])}return{profileIdc:i,levelIdc:s,profileCompatibility:a,width:Math.ceil((16*(l+1)-2*m-2*b)*w),height:(2-u)*(c+1)*16-2*v-2*T}}},s.prototype=new r,e.exports={H264Stream:s,NalByteStream:a}},{}],3:[function(t,e,i){"use strict";var s=t(15),a=function(t){this.numberOfTracks=0,this.metadataStream=t.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,a.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),void("audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)))}};a.prototype=new s,a.prototype.flush=function(t){var e,i,s,a,n={tags:{},captions:[],metadata:[]};if(this.pendingTracks<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(0===this.pendingTracks&&++this.processedTracks<this.numberOfTracks)return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?a=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(a=this.audioTrack.timelineStartInfo.pts),n.tags.videoTags=this.videoTags,n.tags.audioTags=this.audioTags,s=0;s<this.pendingCaptions.length;s++)i=this.pendingCaptions[s],i.startTime=i.startPts-a,i.startTime/=9e4,i.endTime=i.endPts-a,i.endTime/=9e4,n.captions.push(i);for(s=0;s<this.pendingMetadata.length;s++)e=this.pendingMetadata[s],e.cueTime=e.pts-a,e.cueTime/=9e4,n.metadata.push(e);n.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",n),this.trigger("done")}},e.exports=a},{}],4:[function(t,e,i){"use strict";var s=t(5),a=function(t,e,i){var a,n,r,o=new Uint8Array(9),h=new DataView(o.buffer);return t=t||0,e=void 0===e||e,i=void 0===i||i,h.setUint8(0,70),h.setUint8(1,76),h.setUint8(2,86),h.setUint8(3,1),h.setUint8(4,(e?4:0)|(i?1:0)),h.setUint32(5,o.byteLength),t<=0?(n=new Uint8Array(o.byteLength+4),n.set(o),n.set([0,0,0,0],o.byteLength),n):(a=new s(s.METADATA_TAG),a.pts=a.dts=0,a.writeMetaDataDouble("duration",t),r=a.finalize().length,n=new Uint8Array(o.byteLength+r),n.set(o),n.set(h.byteLength,r),n)};e.exports=a},{}],5:[function(t,e,i){"use strict";var s;s=function(t,e){var i,a=0,n=16384,r=function(t,e){var i,s=t.position+e;s<t.bytes.byteLength||(i=new Uint8Array(2*s),i.set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},o=s.widthBytes||new Uint8Array("width".length),h=s.heightBytes||new Uint8Array("height".length),p=s.videocodecidBytes||new Uint8Array("videocodecid".length);if(!s.widthBytes){for(i=0;i<"width".length;i++)o[i]="width".charCodeAt(i);for(i=0;i<"height".length;i++)h[i]="height".charCodeAt(i);for(i=0;i<"videocodecid".length;i++)p[i]="videocodecid".charCodeAt(i);s.widthBytes=o,s.heightBytes=h,s.videocodecidBytes=p}switch(this.keyFrame=!1,t){case s.VIDEO_TAG:this.length=16,n*=6;break;case s.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case s.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(n),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=e,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var s,a=e||0;i=i||t.byteLength,s=a+i,r(this,i),this.bytes.set(t.subarray(a,s),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){r(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){r(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===a?0:this.length-(a+4)},this.startNalUnit=function(){if(a>0)throw new Error("Attempted to create new NAL wihout closing the old one");a=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===a+4?this.length-=4:a>0&&(e=a+4,i=this.length-e,this.position=a,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),a=0},this.writeMetaDataDouble=function(t,e){var i;if(r(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(o,this.position),this.position+=5;else if("height"===t)this.bytes.set(h,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(p,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++a},this.writeMetaDataBoolean=function(t,e){var i;for(r(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)r(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;r(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++a},this.finalize=function(){var t,i;switch(this.bytes[0]){case s.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||e?16:32),this.bytes[12]=e?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case s.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=e?0:1;break;case s.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,a),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return i=this.length-11,this.bytes[1]=(16711680&i)>>>16,this.bytes[2]=(65280&i)>>>8,this.bytes[3]=(255&i)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,r(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=s.frameTime(this.bytes),this}},s.AUDIO_TAG=8,s.VIDEO_TAG=9,s.METADATA_TAG=18,s.isAudioFrame=function(t){return s.AUDIO_TAG===t[0]},s.isVideoFrame=function(t){return s.VIDEO_TAG===t[0]},s.isMetaData=function(t){return s.METADATA_TAG===t[0]},s.isKeyFrame=function(t){return s.isVideoFrame(t)?23===t[11]:!!s.isAudioFrame(t)||!!s.isMetaData(t)},s.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24},e.exports=s},{}],6:[function(t,e,i){e.exports={tag:t(5),Transmuxer:t(8),getFlvHeader:t(4)}},{}],7:[function(t,e,i){"use strict";var s=function(){var t=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return t.list.length}})};e.exports=s},{}],8:[function(t,e,i){"use strict";var s,a,n,r,o,h,p=t(15),d=t(5),l=t(10),c=t(1),u=t(2).H264Stream,f=t(3),g=t(7);r=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},o=function(t,e){var i=new d(d.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},h=function(t,e){var i,s=new d(d.VIDEO_TAG,!0);for(s.dts=e,s.pts=e,s.writeByte(1),s.writeByte(t.profileIdc),s.writeByte(t.profileCompatibility),s.writeByte(t.levelIdc),s.writeByte(255),s.writeByte(225),s.writeShort(t.sps[0].length),s.writeBytes(t.sps[0]),s.writeByte(t.pps.length),i=0;i<t.pps.length;++i)s.writeShort(t.pps[i].length),s.writeBytes(t.pps[i]);return s},n=function(t){var e,i=[];n.prototype.init.call(this),this.push=function(e){r(t,e),t&&void 0===t.channelcount&&(t.audioobjecttype=e.audioobjecttype,t.channelcount=e.channelcount,t.samplerate=e.samplerate,t.samplingfrequencyindex=e.samplingfrequencyindex,t.samplesize=e.samplesize,t.extraData=t.audioobjecttype<<11|t.samplingfrequencyindex<<7|t.channelcount<<3),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),i.push(e)},this.flush=function(){var s,a,n,r=new g;if(0===i.length)return void this.trigger("done","AudioSegmentStream");for(n=-1/0;i.length;)s=i.shift(),(t.extraData!==e||s.pts-n>=1e3)&&(a=new d(d.METADATA_TAG),a.pts=s.pts,a.dts=s.dts,a.writeMetaDataDouble("audiocodecid",10),a.writeMetaDataBoolean("stereo",2===t.channelcount),a.writeMetaDataDouble("audiosamplerate",t.samplerate),a.writeMetaDataDouble("audiosamplesize",16),r.push(a.finalize()),e=t.extraData,a=new d(d.AUDIO_TAG,!0),a.pts=s.pts,a.dts=s.dts,a.view.setUint16(a.position,t.extraData),a.position+=2,a.length=Math.max(a.length,a.position),r.push(a.finalize()),n=s.pts),a=new d(d.AUDIO_TAG),a.pts=s.pts,a.dts=s.dts,a.writeBytes(s.data),r.push(a.finalize());e=null,this.trigger("data",{track:t,tags:r.list}),this.trigger("done","AudioSegmentStream")}},n.prototype=new p,a=function(t){var e,i,s=[];a.prototype.init.call(this),this.finishFrame=function(s,a){if(a){if(e&&t&&t.newMetadata&&(a.keyFrame||0===s.length)){var n=o(e,a.dts).finalize(),r=h(t,a.dts).finalize();n.metaDataTag=r.metaDataTag=!0,s.push(n),s.push(r),t.newMetadata=!1}a.endNalUnit(),s.push(a.finalize()),i=null}},this.push=function(e){r(t,e),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),s.push(e)},this.flush=function(){for(var a,n=new g;s.length&&"access_unit_delimiter_rbsp"!==s[0].nalUnitType;)s.shift();if(0===s.length)return void this.trigger("done","VideoSegmentStream");for(;s.length;)a=s.shift(),"seq_parameter_set_rbsp"===a.nalUnitType?(t.newMetadata=!0,e=a.config,t.width=e.width,t.height=e.height,t.sps=[a.data],t.profileIdc=e.profileIdc,t.levelIdc=e.levelIdc,t.profileCompatibility=e.profileCompatibility,i.endNalUnit()):"pic_parameter_set_rbsp"===a.nalUnitType?(t.newMetadata=!0,t.pps=[a.data],i.endNalUnit()):"access_unit_delimiter_rbsp"===a.nalUnitType?(i&&this.finishFrame(n,i),i=new d(d.VIDEO_TAG),i.pts=a.pts,i.dts=a.dts):("slice_layer_without_partitioning_rbsp_idr"===a.nalUnitType&&(i.keyFrame=!0),i.endNalUnit()),i.startNalUnit(),i.writeBytes(a.data);i&&this.finishFrame(n,i),this.trigger("data",{track:t,tags:n.list}),this.trigger("done","VideoSegmentStream")}},a.prototype=new p,s=function(t){var e,i,r,o,h,p,d,g,y,m,b,v,T=this;s.prototype.init.call(this),t=t||{},this.metadataStream=new l.MetadataStream,t.metadataStream=this.metadataStream,e=new l.TransportPacketStream,i=new l.TransportParseStream,r=new l.ElementaryStream,o=new l.TimestampRolloverStream("video"),h=new l.TimestampRolloverStream("audio"),p=new l.TimestampRolloverStream("timed-metadata"),d=new c,g=new u,v=new f(t),e.pipe(i).pipe(r),r.pipe(o).pipe(g),r.pipe(h).pipe(d),r.pipe(p).pipe(this.metadataStream).pipe(v),b=new l.CaptionStream,g.pipe(b).pipe(v),r.on("data",function(t){var e,i,s;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(s=t.tracks[e]);i&&!y&&(v.numberOfTracks++,y=new a(i),g.pipe(y).pipe(v)),s&&!m&&(v.numberOfTracks++,m=new n(s),d.pipe(m).pipe(v))}}),this.push=function(t){e.push(t)},this.flush=function(){e.flush()},v.on("data",function(t){T.trigger("data",t)}),v.on("done",function(){T.trigger("done")})},s.prototype=new p,e.exports=s},{}],9:[function(t,e,i){"use strict";var s=t(15),a=function(t){for(var e=0,i={payloadType:-1,payloadSize:0},s=0,a=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)s+=255,e++;for(s+=t[e++];255===t[e];)a+=255,e++;if(a+=t[e++],!i.payload&&4===s){i.payloadType=s,i.payloadSize=a,i.payload=t.subarray(e,e+a);break}e+=a,s=0,a=0}return i},n=function(t){return 181!==t.payload[0]?null:49!=(t.payload[1]<<8|t.payload[2])?null:"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])?null:3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)},r=function(t,e){var i,s,a,n,r=[];if(!(64&e[0]))return r;for(s=31&e[0],i=0;i<s;i++)a=3*i,n={type:3&e[a+2],pts:t},4&e[a+2]&&(n.ccData=e[a+3]<<8|e[a+4],r.push(n));return r},o=function(){o.prototype.init.call(this),this.captionPackets_=[],this.field1_=new l,this.field1_.on("data",this.trigger.bind(this,"data")),this.field1_.on("done",this.trigger.bind(this,"done"))};o.prototype=new s,o.prototype.push=function(t){var e,i;"sei_rbsp"===t.nalUnitType&&(e=a(t.escapedRBSP),4===e.payloadType&&(i=n(e))&&(this.captionPackets_=this.captionPackets_.concat(r(t.pts,i))))},o.prototype.flush=function(){if(!this.captionPackets_.length)return void this.field1_.flush();this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(this.field1_.push,this.field1_),this.captionPackets_.length=0,this.field1_.flush()};var h={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608},p=function(t){return null===t?"":(t=h[t]||t,String.fromCharCode(t))},d=function(){for(var t=[],e=15;e--;)t.push("");return t},l=function(){l.prototype.init.call(this),this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=d(),this.nonDisplayed_=d(),this.lastControlCode_=null,this.push=function(t){if(0===t.type){var e,i,s,a;if((e=32639&t.ccData)===this.lastControlCode_)return void(this.lastControlCode_=null);switch(this.lastControlCode_=4096==(61440&e)?e:null,e){case 0:break;case 5152:this.mode_="popOn";break;case 5167:this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;break;case 5157:this.topRow_=13,this.mode_="rollUp";break;case 5158:this.topRow_=12,this.mode_="rollUp";break;case 5159:this.topRow_=11,this.mode_="rollUp";break;case 5165:this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;break;case 5153:"popOn"===this.mode_?this.nonDisplayed_[14]=this.nonDisplayed_[14].slice(0,-1):this.displayed_[14]=this.displayed_[14].slice(0,-1);break;case 5164:this.flushDisplayed(t.pts),this.displayed_=d();break;case 5166:this.nonDisplayed_=d();break;default:if(s=e>>>8,a=255&e,s>=16&&s<=23&&a>=64&&a<=127&&(16!==s||a<96)&&(s=32,a=null),(17===s||25===s)&&a>=48&&a<=63&&(s=9834,a=""),16==(240&s))return;0===s&&(s=null),0===a&&(a=null),this[this.mode_](t.pts,s,a)}}}};l.prototype=new s,l.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t){return t.trim()}).filter(function(t){return t.length}).join("\n");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e})},l.prototype.popOn=function(t,e,i){var s=this.nonDisplayed_[14];s+=p(e),s+=p(i),this.nonDisplayed_[14]=s},l.prototype.rollUp=function(t,e,i){var s=this.displayed_[14];""===s&&(this.flushDisplayed(t),this.startPts_=t),s+=p(e),s+=p(i),this.displayed_[14]=s},l.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.topRow_;t<14;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[14]=""},e.exports={CaptionStream:o,Cea608Stream:l}},{}],10:[function(t,e,i){"use strict";var s,a,n,r=t(15),o=t(9),h=t(12),p=t(13).TimestampRolloverStream,d=t(12);s=function(){var t=new Uint8Array(188),e=0;s.prototype.init.call(this),this.push=function(i){var s,a=0,n=188;for(e?(s=new Uint8Array(i.byteLength+e),s.set(t.subarray(0,e)),s.set(i,e),e=0):s=i;n<s.byteLength;)71!==s[a]||71!==s[n]?(a++,n++):(this.trigger("data",s.subarray(a,n)),a+=188,n+=188);a<s.byteLength&&(t.set(s.subarray(a),0),e=s.byteLength-a)},this.flush=function(){188===e&&71===t[0]&&(this.trigger("data",t),e=0),this.trigger("done")}},s.prototype=new r,a=function(){var t,e,i,s;a.prototype.init.call(this),s=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,t=function(t,s){var a=0;s.payloadUnitStartIndicator&&(a+=t[a]+1),"pat"===s.type?e(t.subarray(a),s):i(t.subarray(a),s)},e=function(t,e){e.section_number=t[7],e.last_section_number=t[8],s.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=s.pmtPid},i=function(t,e){var i,a,n,r;if(1&t[5]){for(s.programMapTable={},i=(15&t[1])<<8|t[2],a=3+i-4,n=(15&t[10])<<8|t[11],r=12+n;r<a;)s.programMapTable[(31&t[r+1])<<8|t[r+2]]=t[r],r+=5+((15&t[r+3])<<8|t[r+4]);for(e.programMapTable=s.programMapTable;s.packetsWaitingForPmt.length;)s.processPes_.apply(s,s.packetsWaitingForPmt.shift())}},this.push=function(e){var i={},s=4;i.payloadUnitStartIndicator=!!(64&e[1]),i.pid=31&e[1],i.pid<<=8,i.pid|=e[2],(48&e[3])>>>4>1&&(s+=e[s]+1),0===i.pid?(i.type="pat",t(e.subarray(s),i),this.trigger("data",i)):i.pid===this.pmtPid?(i.type="pmt",t(e.subarray(s),i),this.trigger("data",i)):void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,s,i]):this.processPes_(e,s,i)},this.processPes_=function(t,e,i){i.streamType=this.programMapTable[i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}},a.prototype=new r,a.STREAM_TYPES={h264:27,adts:15},n=function(){var t=this,e={data:[],size:0},i={data:[],size:0},s={data:[],size:0},a=function(t,e){var i;e.packetLength=6+(t[4]<<8|t[5]),e.dataAlignmentIndicator=0!=(4&t[6]),i=t[7],192&i&&(e.pts=(14&t[9])<<27|(255&t[10])<<20|(254&t[11])<<12|(255&t[12])<<5|(254&t[13])>>>3,e.pts*=4,e.pts+=(6&t[13])>>>1,e.dts=e.pts,64&i&&(e.dts=(14&t[14])<<27|(255&t[15])<<20|(254&t[16])<<12|(255&t[17])<<5|(254&t[18])>>>3,e.dts*=4,e.dts+=(6&t[18])>>>1)),e.data=t.subarray(9+t[8])},r=function(e,i,s){var n,r=new Uint8Array(e.size),o={type:i},h=0,p=0,d=!1;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,h=0;h<e.data.length;h++)n=e.data[h],r.set(n.data,p),p+=n.data.byteLength;a(r,o),d="video"===i||o.packetLength===e.size,(s||d)&&(e.size=0,e.data.length=0),d&&t.trigger("data",o)}};n.prototype.init.call(this),this.push=function(a){({pat:function(){},pes:function(){var t,n;switch(a.streamType){case h.H264_STREAM_TYPE:case d.H264_STREAM_TYPE:t=e,n="video";break;case h.ADTS_STREAM_TYPE:t=i,n="audio";break;case h.METADATA_STREAM_TYPE:t=s,n="timed-metadata";break;default:return}a.payloadUnitStartIndicator&&r(t,n,!0),t.data.push(a),t.size+=a.data.byteLength},pmt:function(){var e,i,s={type:"metadata",tracks:[]},n=a.programMapTable;for(e in n)n.hasOwnProperty(e)&&(i={timelineStartInfo:{baseMediaDecodeTime:0}},i.id=+e,n[e]===d.H264_STREAM_TYPE?(i.codec="avc",i.type="video"):n[e]===d.ADTS_STREAM_TYPE&&(i.codec="adts",i.type="audio"),s.tracks.push(i));t.trigger("data",s)}})[a.type]()},this.flush=function(){r(e,"video"),r(i,"audio"),r(s,"timed-metadata"),this.trigger("done")}},n.prototype=new r;var l={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:s,TransportParseStream:a,ElementaryStream:n,TimestampRolloverStream:p,CaptionStream:o.CaptionStream,Cea608Stream:o.Cea608Stream,MetadataStream:t(11)};for(var c in h)h.hasOwnProperty(c)&&(l[c]=h[c]);e.exports=l},{}],11:[function(t,e,i){"use strict";var s,a=t(15),n=t(12),r=function(t,e,i){var s,a="";for(s=e;s<i;s++)a+="%"+("00"+t[s].toString(16)).slice(-2);return a},o=function(t,e,i){return decodeURIComponent(r(t,e,i))},h=function(t,e,i){return unescape(r(t,e,i))},p=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},d={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=o(t.data,1,e),t.value=o(t.data,e+1,t.data.length).replace(/\0*$/,"");break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=o(t.data,1,e),t.url=o(t.data,e+1,t.data.length);break}},PRIV:function(t){var e;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=h(t.data,0,e);break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};s=function(t){var e,i={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},a=0,r=[],o=0;if(s.prototype.init.call(this),this.dispatchType=n.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(e=0;e<i.descriptor.length;e++)this.dispatchType+=("00"+i.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,s,n,h,l,c;if("timed-metadata"===t.type){if(t.dataAlignmentIndicator&&(o=0,r.length=0),0===r.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))return void(i.debug&&console.log("Skipping unrecognized metadata packet"));if(r.push(t),o+=t.data.byteLength,1===r.length&&(a=p(t.data.subarray(6,10)),a+=10),!(o<a)){for(e={data:new Uint8Array(a),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<a;)e.data.set(r[0].data.subarray(0,a-l),l),l+=r[0].data.byteLength,o-=r[0].data.byteLength,r.shift();s=10,64&e.data[5]&&(s+=4,s+=p(e.data.subarray(10,14)),a-=p(e.data.subarray(16,20)));do{if((n=p(e.data.subarray(s+4,s+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if(c=String.fromCharCode(e.data[s],e.data[s+1],e.data[s+2],e.data[s+3]),h={id:c,data:e.data.subarray(s+10,s+n+10)},h.key=h.id,d[h.id]&&(d[h.id](h),"com.apple.streaming.transportStreamTimestamp"===h.owner)){var u=h.data,f=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;f*=4,f+=3&u[7],h.timeStamp=f,void 0===e.pts&&void 0===e.dts&&(e.pts=h.timeStamp,e.dts=h.timeStamp),this.trigger("timestamp",h)}e.frames.push(h),s+=10,s+=n}while(s<a);this.trigger("data",e)}}}},s.prototype=new a,e.exports=s},{}],12:[function(t,e,i){"use strict";e.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],13:[function(t,e,i){"use strict";var s=t(15),a=function(t,e){var i=1;for(t>e&&(i=-1);Math.abs(e-t)>4294967296;)t+=8589934592*i;return t},n=function(t){var e,i;n.prototype.init.call(this),this.type_=t,this.push=function(t){t.type===this.type_&&(void 0===i&&(i=t.dts),t.dts=a(t.dts,i),t.pts=a(t.pts,i),e=t.dts,this.trigger("data",t))},this.flush=function(){i=e,this.trigger("done")},this.discontinuity=function(){i=void 0,e=void 0}};n.prototype=new s,e.exports={TimestampRolloverStream:n,handleRollover:a}},{}],14:[function(t,e,i){"use strict";var s;s=function(t){var e=t.byteLength,i=0,s=0;this.length=function(){return 8*e},this.bitsAvailable=function(){return 8*e+s},this.loadWord=function(){var a=t.byteLength-e,n=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");n.set(t.subarray(a,a+r)),i=new DataView(n.buffer).getUint32(0),s=8*r,e-=r},this.skipBits=function(t){var a;s>t?(i<<=t,s-=t):(t-=s,a=Math.floor(t/8),t-=8*a,e-=a,this.loadWord(),i<<=t,s-=t)},this.readBits=function(t){var a=Math.min(s,t),n=i>>>32-a;return s-=a,s>0?i<<=a:e>0&&this.loadWord(),a=t-a,a>0?n<<a|this.readBits(a):n},this.skipLeadingZeros=function(){var t;for(t=0;t<s;++t)if(0!=(i&2147483648>>>t))return i<<=t,s-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},e.exports=s},{}],15:[function(t,e,i){"use strict";var s=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e]=t[e].concat(i)},this.off=function(e,i){var s;return!!t[e]&&(s=t[e].indexOf(i),t[e]=t[e].slice(),t[e].splice(s,1),s>-1)},this.trigger=function(e){var i,s,a,n;if(i=t[e])if(2===arguments.length)for(a=i.length,s=0;s<a;++s)i[s].call(this,arguments[1]);else{for(n=[],s=arguments.length,s=1;s<arguments.length;++s)n.push(arguments[s]);for(a=i.length,s=0;s<a;++s)i[s].apply(this,n)}},this.dispose=function(){t={}}}};s.prototype.pipe=function(t){return this.on("data",function(e){t.push(e)}),this.on("done",function(e){t.flush(e)}),t},s.prototype.push=function(t){this.trigger("data",t)},s.prototype.flush=function(t){this.trigger("done",t)},e.exports=s},{}]},{},[6]);